<!DOCTYPE html>
<html>
<head>
  <title>Decentralized Communication Platform</title>
 <style>
    body {
      font-family: sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
    }

    h1, h2 {
      text-align: center;
      color: #333;
    }

    #registerForm, #loginForm {
      width: 300px;
      margin: 20px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    #registerForm input, #loginForm input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    #registerForm button, #loginForm button {
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #registerForm button:hover, #loginForm button:hover {
      background-color: #0056b3;
    }

    #messages {
      list-style-type: none;
      margin: 20px auto;
      padding: 0;
      width: 80%;
    }

    #messages li {
      padding: 10px;
      background-color: #fff;
      border-bottom: 1px solid #eee;
    }

    #messages li:nth-child(odd) {
      background-color: #f9f9f9;
    }

    #messageForm {
      width: 80%;
      margin: 20px auto;
      display: flex;
    }

    #messageForm input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #messageForm button {
      padding: 10px 15px;
      background-color: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #messageForm button:hover {
      background-color: #1e7e34;
    }
  </style>
</head>
<body>
  <h1>Decentralized Communication Platform</h1>

  <h2>Register</h2>
  <form id="registerForm">
    <input type="email" id="registerEmail" placeholder="Email" required>
    <input type="password" id="registerPassword" placeholder="Password" required>
    <button type="submit">Register</button>
  </form>

  <h2>Login</h2>
  <form id="loginForm">
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>

  <h2>Create Server</h2>
  <form id="createServerForm">
    <input type="text" id="serverName" placeholder="Server Name" required>
    <input type="text" id="serverDescription" placeholder="Server Description">
    <button type="submit">Create Server</button>
  </form>

  <h2>Chat</h2>
  <ul id="messages"></ul>
  <form id="messageForm">
    <input id="messageInput" autocomplete="off" /><button>Send</button>
  </form>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    let socket = null;
    let token = null;

    const messages = document.getElementById('messages');
    const form = document.getElementById('messageForm');
    const input = document.getElementById('messageInput');
    const registerForm = document.getElementById('registerForm');
    const loginForm = document.getElementById('loginForm');
    const createServerForm = document.getElementById('createServerForm');
    const registerEmail = document.getElementById('registerEmail');
    const registerPassword = document.getElementById('registerPassword');
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const serverName = document.getElementById('serverName');
    const serverDescription = document.getElementById('serverDescription');

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = registerEmail.value;
      const password = registerPassword.value;

      try {
        const response = await fetch('/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        });

        if (response.ok) {
          alert('Registration successful!');
        } else {
          alert('Registration failed.');
        }
      } catch (error) {
        console.error('Error registering:', error);
        alert('Registration failed.');
      }
    });

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = loginEmail.value;
      const password = loginPassword.value;

      try {
        const response = await fetch('/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        });

        if (response.ok) {
          const data = await response.json();
          token = data.token;
          alert('Login successful!');
          socket = io({ auth: { token: token } });

          socket.on('new-message', (message) => {
            const item = document.createElement('li');
            item.textContent = message;
            messages.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
          });


        } else {
          alert('Login failed.');
        }
      } catch (error) {
        console.error('Error logging in:', error);
        alert('Login failed.');
      }
    });

    createServerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = serverName.value;
      const description = serverDescription.value;

      try {
        const response = await fetch('/servers', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}` // Include the token
          },
          body: JSON.stringify({ name, description })
        });

        if (response.ok) {
          alert('Server created successfully!');
        } else {
          alert('Server creation failed.');
        }
      } catch (error) {
        console.error('Error creating server:', error);
        alert('Server creation failed.');
      }
    });


    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (input.value && token) {
        socket.emit('new-message', input.value);
        input.value = '';
      } else {
        alert('Please login to send messages.');
      }
    });
  </script>
</body>
</html>
